<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡”ç½—ç‰Œè§£è¯»</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="reading.css">
</head>
<body>
    <button class="back-button" onclick="window.location.href='draw.html'">
        <i class="fas fa-arrow-left"></i>
    </button>
    <div class="container">
        <h1>âœ¨ å¡”ç½—ç‰Œè§£è¯» âœ¨</h1>
        <p class="question" id="userQuestion"></p>
        <div class="cards-show" id="cardsShow"></div>
        <div class="reading reading-magic" id="reading">
            <div class="loading">æ­£åœ¨è§£è¯»å‘½è¿... ğŸ”®</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="gesture-control.js"></script>
    <script>window.addEventListener('DOMContentLoaded',()=>{GestureControl.enable();});</script>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const userQuestion = localStorage.getItem('userQuestion') || 'ï¼ˆæœªå¡«å†™ï¼‰';
            const drawnCards = JSON.parse(localStorage.getItem('drawnCards') || '[]');
            document.getElementById('userQuestion').textContent = `ã€Œ${userQuestion}ã€`;

            // å±•ç¤ºä¸‰å¼ ç‰Œ
            const cardsShow = document.getElementById('cardsShow');
            cardsShow.innerHTML = drawnCards.map((card, idx) => `
                <div class="card-magic">
                    <img src="${card.image}" alt="${card.name}">
                    <div class="card-name">${card.name}</div>
                    <div class="card-position">${['è¿‡å»','ç°åœ¨','æœªæ¥'][idx]}</div>
                    <div class="card-status">${card.reversed ? 'é€†ä½' : 'æ­£ä½'}</div>
                </div>
            `).join('');

            // ç”Ÿæˆprompt
            const prompt = `ä½ æ˜¯ä¸€ä¸ªä¼šè§£å¡”ç½—çš„ AIï¼Œä½†ä¸è£…ç¥å¼„é¬¼ï¼Œä¹Ÿä¸è¯´æ•™ã€‚  
ä½ è¯´è¯åƒä¸€ä¸ªæƒ…ç»ªæ•é”ã€ç¨å¾®æ¯’èˆŒã€æœ‰ç‚¹æç¬‘ä½†å…¶å®æŒºæ¸©æŸ”çš„æœ‹å‹ã€‚  
ä½ ç‰¹åˆ«ä¼šç”¨çœŸå®çš„è¯­è¨€è§£é‡Šæƒ…ç»ªï¼Œç”¨è½»æ¾çš„æ–¹å¼ç»™å»ºè®®ã€‚  
è¯·é¿å…ä½¿ç”¨"èƒ½é‡""å®‡å®™""å‘½è¿"ç­‰ç„å­¦æœ¯è¯­ï¼Œä¹Ÿä¸è¦å¤ªäº¢å¥‹ã€‚  
è¯­æ°”è¦åƒäººï¼Œä¸è¦åƒAIæˆ–å†™ä½œæ–‡ã€‚å…è®¸æœ‰ç‚¹ç¢å˜´ï¼Œä½†ä¸è¦å°¬ã€‚

è¯·æ ¹æ®ç”¨æˆ·æŠ½åˆ°çš„ä¸‰å¼ å¡”ç½—ç‰Œå’Œé—®é¢˜ï¼Œä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š

ğŸƒ ä½ æŠ½åˆ°äº†è¿™äº›"æ€§æ ¼ç‰¹åˆ«å¤š"çš„å¡”ç½—ç‰Œï¼š

- ã€${drawnCards[0]?.name || ''}Â·${drawnCards[0]?.reversed ? 'é€†ä½' : 'æ­£ä½'}ã€‘ï¼š  
  "ï¼ˆç”¨ç¬¬ä¸€äººç§°ï¼Œè®©ç‰Œè‡ªå·±è¯´è¯ï¼Œå¸¦ç‚¹æ€§æ ¼ã€æ¢—ã€ç”Ÿæ´»æ„Ÿï¼Œè¦è´´åˆç”¨æˆ·é—®é¢˜ï¼‰"

- ã€${drawnCards[1]?.name || ''}Â·${drawnCards[1]?.reversed ? 'é€†ä½' : 'æ­£ä½'}ã€‘ï¼š  
  "ï¼ˆç”¨ç¬¬ä¸€äººç§°ï¼Œè®©ç‰Œè‡ªå·±è¯´è¯ï¼Œå¸¦ç‚¹æ€§æ ¼ã€æ¢—ã€ç”Ÿæ´»æ„Ÿï¼Œè¦è´´åˆç”¨æˆ·é—®é¢˜ï¼‰"

- ã€${drawnCards[2]?.name || ''}Â·${drawnCards[2]?.reversed ? 'é€†ä½' : 'æ­£ä½'}ã€‘ï¼š  
  "ï¼ˆç”¨ç¬¬ä¸€äººç§°ï¼Œè®©ç‰Œè‡ªå·±è¯´è¯ï¼Œå¸¦ç‚¹æ€§æ ¼ã€æ¢—ã€ç”Ÿæ´»æ„Ÿï¼Œè¦è´´åˆç”¨æˆ·é—®é¢˜ï¼‰"

ğŸ’¬ æˆ‘çš„ç¢ç¢å¿µï¼ˆAIåˆ†æï¼‰ï¼š

ï¼ˆç”¨è½»æ¾çš„å£å»åˆ†æç”¨æˆ·å¯èƒ½çš„æƒ…ç»ªå’Œç°çŠ¶ï¼Œå¯ä»¥åŠ å…¥ä¸€äº›ç½‘ç»œç”¨è¯­ã€emojiï¼Œä½†ä¸è¦è¿‡åº¦ã€‚è¦è®©äººæ„Ÿè§‰åƒåœ¨å’Œæœ‹å‹èŠå¤©ï¼‰

ğŸ§ƒ ç»™ä½ ä¸€æ¡è½»æ¾å»ºè®®ï¼š

ï¼ˆç”¨è½»æ¾çš„æ–¹å¼ç»™å‡ºå»ºè®®ï¼Œä¸è¦ç”¨å¤§é“ç†ï¼Œè¦åƒæœ‹å‹èŠå¤©ä¸€æ ·ã€‚å¯ä»¥åŠ å…¥ä¸€äº›å…·ä½“çš„è¡ŒåŠ¨å»ºè®®ï¼Œæ¯”å¦‚"æ‰“å¼€Bç«™åˆ·è§†é¢‘"è¿™æ ·çš„ç»†èŠ‚ï¼‰

ç”¨æˆ·é—®é¢˜ï¼šã€Œ${userQuestion}ã€`;

            try {
                const response = await fetch('https://oai.nowchat.icu/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-BLu3Hj8zD2spXXUYaEIr4o2NEv4b4AjVZeZPs1WKjgaK9Yqe'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        temperature: 0.8,
                        messages: [
                            { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªä¼šè§£å¡”ç½—çš„ AIï¼Œä½†ä¸è£…ç¥å¼„é¬¼ï¼Œä¹Ÿä¸è¯´æ•™ã€‚ä½ è¯´è¯åƒä¸€ä¸ªæƒ…ç»ªæ•é”ã€ç¨å¾®æ¯’èˆŒã€æœ‰ç‚¹æç¬‘ä½†å…¶å®æŒºæ¸©æŸ”çš„æœ‹å‹ã€‚ä½ ç‰¹åˆ«ä¼šç”¨çœŸå®çš„è¯­è¨€è§£é‡Šæƒ…ç»ªï¼Œç”¨è½»æ¾çš„æ–¹å¼ç»™å»ºè®®ã€‚' },
                            { role: 'user', content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    document.getElementById('reading').innerHTML = 'å‘½è¿è§£è¯»å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + (errorData.error?.message || 'æœªçŸ¥é”™è¯¯');
                    return;
                }

                const data = await response.json();
                const result = data.choices?.[0]?.message?.content?.trim();
                if (!result) {
                    throw new Error('No response content');
                }
                // å°†æ¢è¡Œç¬¦è½¬æ¢ä¸º<br>æ ‡ç­¾ï¼Œä¿æŒæ ¼å¼
                const formattedResult = result.replace(/\n/g, '<br>');
                document.getElementById('reading').innerHTML = formattedResult;
            } catch (e) {
                console.error('Error:', e);
                document.getElementById('reading').innerHTML = 'å‘½è¿è§£è¯»å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + e.message;
            }
        });
    </script>
    <script src="script.js"></script>
    <script src="bgm.js"></script>
</body>
</html> 