<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡”ç½—ç‰Œè§£è¯»</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="reading.css">
</head>
<body>
    <button class="back-button" onclick="window.location.href='draw.html'">
        <i class="fas fa-arrow-left"></i>
    </button>
    <div class="container">
        <h1>âœ¨ å¡”ç½—ç‰Œè§£è¯» âœ¨</h1>
        <p class="question" id="userQuestion"></p>
        <div class="cards-show" id="cardsShow"></div>
        <div class="reading reading-magic" id="reading">
            <div class="loading">æ­£åœ¨è§£è¯»å‘½è¿... ğŸ”®</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const userQuestion = localStorage.getItem('userQuestion') || 'ï¼ˆæœªå¡«å†™ï¼‰';
            const drawnCards = JSON.parse(localStorage.getItem('drawnCards') || '[]');
            document.getElementById('userQuestion').textContent = `ã€Œ${userQuestion}ã€`;

            // å±•ç¤ºä¸‰å¼ ç‰Œ
            const cardsShow = document.getElementById('cardsShow');
            cardsShow.innerHTML = drawnCards.map((card, idx) => `
                <div class="card-magic">
                    <img src="${card.image}" alt="${card.name}">
                    <div class="card-name">${card.name}</div>
                    <div class="card-position">${['è¿‡å»','ç°åœ¨','æœªæ¥'][idx]}</div>
                    <div class="card-status">${card.reversed ? 'é€†ä½' : 'æ­£ä½'}</div>
                </div>
            `).join('');

            // ç”Ÿæˆprompt
            const prompt = `ä½ æ˜¯ä¸€ä½å…·æœ‰åŒç†å¿ƒå’Œç°å®åˆ¤æ–­åŠ›çš„å¡”ç½—ç‰Œè§£è¯»è€…ã€‚\n\nç”¨æˆ·ç»™å‡ºäº†ä¸€ä¸ªå…·ä½“çš„é—®é¢˜ï¼Œå¹¶æŠ½å–äº†ä¸‰å¼ å¡”ç½—ç‰Œï¼ˆåŒ…å«æ­£ä½æˆ–é€†ä½ï¼‰ã€‚è¯·ä½ æ ¹æ®è¿™äº›ä¿¡æ¯ï¼š\n\n1. å‡†ç¡®åˆ†æç”¨æˆ·çš„é—®é¢˜åœ¨ç°å®ä¸­å¯èƒ½æ¶‰åŠçš„å¿ƒç†ã€è¡Œä¸ºæˆ–ç¯å¢ƒå› ç´ ã€‚\n2. æ ¹æ®æ¯å¼ ç‰Œçš„å«ä¹‰ï¼ŒæŒ‡å‡ºç”¨æˆ·å½“å‰å¤„å¢ƒä¸­å€¼å¾—æ³¨æ„çš„å…³é”®ç‚¹ã€‚\n3. ç»¼åˆä¸‰å¼ ç‰Œï¼Œç»™å‡ºæœ‰é’ˆå¯¹æ€§ã€å…·æœ‰å®é™…è¡ŒåŠ¨æ€§çš„å»ºè®®ï¼Œå¸®åŠ©ç”¨æˆ·åšå‡ºå†³ç­–æˆ–è·å¾—æ”¯æŒã€‚\n\nè¯·ä½¿ç”¨ä»¥ä¸‹ç»“æ„è¾“å‡ºï¼š\n\nğŸ”®ã€å‘½è¿æŒ‡å¼•ã€‘ï¼šç”¨2å¥è¯ç»™å‡ºå¯¹å½“å‰é—®é¢˜çš„æ€»ä½“åˆ¤æ–­å’Œè¶‹åŠ¿  \nğŸƒã€ç‰Œé¢è§£æã€‘ï¼š  \n- è¿‡å»ï¼š[${drawnCards[0]?.name || ''}]ï¼ˆ${drawnCards[0]?.reversed ? 'é€†ä½' : 'æ­£ä½'}ï¼‰â†’  \n- ç°åœ¨ï¼š[${drawnCards[1]?.name || ''}]ï¼ˆ${drawnCards[1]?.reversed ? 'é€†ä½' : 'æ­£ä½'}ï¼‰â†’  \n- æœªæ¥ï¼š[${drawnCards[2]?.name || ''}]ï¼ˆ${drawnCards[2]?.reversed ? 'é€†ä½' : 'æ­£ä½'}ï¼‰â†’  \nğŸ’¡ã€å®ç”¨å»ºè®®ã€‘ï¼šè¯·æå‡º 3 æ¡æœ‰ç°å®å‚è€ƒä»·å€¼çš„å»ºè®®ï¼Œè¯­è¨€æ¸©å’Œã€å…·ä½“ï¼Œä¸è¦ç©ºæ´å¥—è¯ã€‚\n\nç”¨æˆ·é—®é¢˜ï¼šã€Œ${userQuestion}ã€`;

            try {
                const response = await fetch('https://oai.nowchat.icu/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-BLu3Hj8zD2spXXUYaEIr4o2NEv4b4AjVZeZPs1WKjgaK9Yqe'
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        temperature: 0.8,
                        messages: [
                            { role: 'system', content: 'ä½ æ˜¯ä¸€ä½å…·æœ‰åŒç†å¿ƒå’Œç°å®åˆ¤æ–­åŠ›çš„å¡”ç½—ç‰Œè§£è¯»è€…ã€‚' },
                            { role: 'user', content: prompt }
                        ]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    document.getElementById('reading').innerHTML = 'å‘½è¿è§£è¯»å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + (errorData.error?.message || 'æœªçŸ¥é”™è¯¯');
                    return;
                }

                const data = await response.json();
                const result = data.choices?.[0]?.message?.content?.trim();
                if (!result) {
                    throw new Error('No response content');
                }
                document.getElementById('reading').innerHTML = result;
            } catch (e) {
                console.error('Error:', e);
                document.getElementById('reading').innerHTML = 'å‘½è¿è§£è¯»å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + e.message;
            }
        });
    </script>
    <script src="script.js"></script>
    <script src="bgm.js"></script>
</body>
</html> 